## 1.몽고DB 소개

먼저 몽고 DB의 주요한 디자인 철학에 대해서 알아보자.

### 손쉬운 사용

몽고 DB는 도큐먼트 지향 데이터베이스로, 빠르고 유연한 확장을 지원한다.  
도큐먼트는 내부 값으로 내장 도큐먼트, 배열을 사용할 수 있기 때문에, 복잡한 계층 구조를 그대로 저장할 수 있다.  
이를 통해 실제 프로그래밍에서 사용하는 객체와 유사한 구조로 데이터를 저장할 수 있다.    
또한 도큐먼트에는 고정된 스키마가 없기 때문에 자유롭게 필드를 추가 및 제거할 수 있다.

### 확장 가능한 설계

몽고 DB는 분산 확장(scale out)을 염두에 두고 설계되었다.  
분산 확장은 DB 확장 시 데이터 스토리지의 스펙을 올리는 대신, 더 많은 스토리지에 데이터를 나눠서 저장하는 스케일링 방법이다.  
도큐먼트는 데이터 계층 구조를 그대로 저장하기 때문에 분산 확장에 보다 적합한 구조이다.  
몽고 DB는 여러 대의 서버에 데이터를 분산해서 저장하고, 데이터 조회 시 적절한 서버를 찾아서 라우팅하도록 지원한다.  
관련된 처리를 DB에서 자체적으로 수행하기 때문에, 스케일링 설정에 변동이 생겨도 어플리케이션은 수정하지 않아도 된다.

### 다양한 기능

몽고 DB는 기본 CRUD를 비롯한 DBMS의 기능과 더불어서, 확장된 기능들을 추가 제공한다.  
먼저 몽고 DB는 보조 인덱싱을 지원하여, 기본적인 unique, compound 인덱싱을 지원한다.  
여기에 추가적으로 도큐먼트의 특성에 맞게 공간 정보, full text, nested document에 대한 인덱싱도 지원한다.  
또한 데이터 처리 파이프라인에 기반한 최적화된 집계 기능도 지원한다.  
데이터 만료일이 존재하는 데이터에 대해서는 TTL 컬렉션으로 정의하는 것이 가능하며, 기준을 만족하는 일부의 도큐먼트에 인덱싱을 거는 부분 인덱스를 지원한다.  
추가적으로 파일에 대한 저장도 지원하여, 용량이 큰 파일 및 파일 메타 데이터 저장이 가능하다.

### 고성능

몽고 DB는 고성능을 유지할 수 있도록 설계되었다.  
성능에 영향을 미칠 수 있는 작업들의 경우 서버에서 수행하지 않고, 클라이언트에 오프로드 된다.  
이를 통해 드라이버 또는 어플리케이션 단에 일부 처리 로직을 위임하여, 서버 단의 성능은 그대로 유지한다.

## 2. 몽고 DB 기본

### 2.1. 도큐먼트

몽고 DB는 키와 값의 쌍으로 이루어진 도큐먼트로 데이터를 저장한다.  
`{"greeting" : "Hello, world!", "views" : 3}`  
값으로 단순히 문자열(blob) 타입이 아닌, 정수 등의 데이터형을 저장할 수 있다.  
각 키는 문자열로 구성되며, 서로 중복되지 않는 유일한 값이어야 한다.

### 2.2. 컬렉션

컬렉션은 도큐먼트의 모음으로, RDB의 테이블과 유사한 개념이다.  

#### 2.2.1 동적 스키마

컬렉션의 가장 큰 특징은 동적 스키마를 지원한다는 것이다.  
몽고 DB에서는 컬렉션 내에 다양한 형태의 도큐먼트를 저장할 수 있도록 허용한다.  
예를 들어 다음의 도큐먼트들이 하나의 컬렉션에 있어도 문제가 되지 않는다.

```js
{"greeting" : "Hello, world!", "views": 3}
{"signoff”: "Good night, and good luck"}
```

하지만 하나의 컬렉션에 완전히 상이한 스키마의 도큐먼트들이 함께 존재하면, 관리하기가 어려워진다.  
또한 상이한 데이터를 하나의 컬렉션에서 관리하기 위해서는 type과 같은 키를 두고 도큐먼트를 구분해야 한다.  
이 때 조회 시에 type으로 쿼리 조건을 줘야 하는데, 단일한 컬렉션에서 조건 없이 조회하는 것에 비해 성능이 저하된다.  
하드웨어 관점에서도 컬렉션으로 구분했을 때 데이터 지역성이 올라가기 때문에, 디스크 탐색 속도를 높이기 위해서는 상이한 데이터는 컬렉션으로 구분해야 한다.  
추가적으로, 인덱싱을 사용하기 위해서도 동일한 데이터 구조를 가져야 한다.  
몽고 DB의 document validation 기능이나, 어플리케이션 단의 object-document mapping 라이브러리를 사용하면 고정된 스키마를 적용할 수 있다.

#### 2.2.2. 네이밍

각 도큐먼트는 문자열로 구성된 이름으로 구분한다.  
몽고 DB에서는 네임스페이스에 .을 붙여서 `blog.posts`, `blog.authors` 등의 이름으로 서브컬렉션을 구성하는 것도 가능하다.  
다만 이는 체계화를 위한 것으로, 컬렉션 간 물리적인 위계 구조를 가지게 되지는 않는다.  
위 예시에서도 `blog` 컬렉션과 `blog.posts` 컬렉션 간 아무런 관계도 없고, 심지어 `blog` 컬렉션은 존재하지 않아도 된다.





